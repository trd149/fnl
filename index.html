<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>Fantasy NASCAR League ‚Äî Standings</title>
  <style>
    :root{
      --bg:#0b0e14;
      --panel:#0f172a;
      --panel2:#111827;
      --line:rgba(255,255,255,.10);
      --text:#e5e7eb;
      --muted:#9ca3af;
      --accent:#d21404;
      --shadow: 0 12px 34px rgba(0,0,0,.40);
      --radius: 16px;
      --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      --sans: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
      --gold1:#f59e0b;
      --gold2:#facc15;
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family:var(--sans);
      color:var(--text);
      background:
        radial-gradient(1200px 600px at 20% -20%, rgba(210,20,4,.18), transparent 60%),
        radial-gradient(900px 500px at 90% 0%, rgba(126,40,17,.18), transparent 55%),
        linear-gradient(180deg, #06080d, var(--bg));
    }

    .wrap{
      max-width: 980px;
      margin: 16px auto 28px;
      padding: 0 12px;
    }

    /* Top bar */
    .top{
      display:flex;
      align-items:flex-end;
      justify-content:space-between;
      gap:10px;
      flex-wrap:wrap;
      margin-bottom:12px;
    }
    .brand{
      display:flex;
      flex-direction:column;
      gap:6px;
      min-width: 240px;
    }
    .brand h1{
      margin:0;
      font-size:20px;
      line-height:1.1;
      letter-spacing:.2px;
      font-weight:900;
    }
    .sub{
      display:flex;
      gap:8px;
      flex-wrap:wrap;
      align-items:center;
      color:var(--muted);
      font-size:12px;
    }
    .pill{
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding:6px 10px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(17,24,39,.55);
      font-family:var(--mono);
      color:#d1d5db;
      font-size:12px;
    }
    .dot{
      width:7px;height:7px;border-radius:99px;
      background:var(--accent);
      box-shadow:0 0 0 3px rgba(210,20,4,.15);
    }

    .controls{
      display:flex;
      gap:10px;
      align-items:center;
      flex-wrap:wrap;
      justify-content:flex-end;
      width:min(520px, 100%);
    }

    .search{
      position:relative;
      flex: 1 1 250px;
      min-width: 200px;
    }
    .search input{
      width:100%;
      padding:10px 12px 10px 36px;
      border-radius:12px;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(17,24,39,.70);
      color:var(--text);
      outline:none;
      box-shadow: inset 0 1px 0 rgba(255,255,255,.05);
    }
    .search input:focus{
      border-color: rgba(210,20,4,.55);
      box-shadow: 0 0 0 4px rgba(210,20,4,.12);
    }
    .search svg{
      position:absolute; left:12px; top:50%;
      transform:translateY(-50%);
      opacity:.75;
    }

    .btn, .select{
      padding:10px 12px;
      border-radius:12px;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(17,24,39,.70);
      color:var(--text);
      cursor:pointer;
      user-select:none;
      white-space:nowrap;
      font-size:13px;
    }
    .btn:hover,.select:hover{ border-color: rgba(255,255,255,.18); }
    .btn:active{ transform: translateY(1px); }
    .btn.primary{
      border-color: rgba(210,20,4,.45);
      background: linear-gradient(180deg, rgba(210,20,4,.30), rgba(126,40,17,.20));
    }
    .select{
      appearance:none;
      padding-right:34px;
      background-image:
        linear-gradient(45deg, transparent 50%, rgba(255,255,255,.65) 50%),
        linear-gradient(135deg, rgba(255,255,255,.65) 50%, transparent 50%);
      background-position:
        calc(100% - 18px) 55%,
        calc(100% - 12px) 55%;
      background-size:6px 6px, 6px 6px;
      background-repeat:no-repeat;
    }

    /* Tabs */
    .tabs{
      display:flex;
      gap:10px;
      align-items:center;
      margin: 10px 0 12px;
      flex-wrap:wrap;
    }
    .tab{
      padding:10px 12px;
      border-radius:12px;
      border:1px solid rgba(255,255,255,.10);
      background:rgba(17,24,39,.55);
      color:var(--text);
      cursor:pointer;
      user-select:none;
      white-space:nowrap;
    }
    .tab:hover{ border-color: rgba(255,255,255,.18); }
    .tab.active{
      border-color: rgba(210,20,4,.45);
      background: linear-gradient(180deg, rgba(210,20,4,.30), rgba(126,40,17,.20));
    }
    .tabPanel{ display:none; }
    .tabPanel.active{ display:block; }

    /* Card container */
    .card{
      background: linear-gradient(180deg, rgba(17,24,39,.78), rgba(15,23,42,.78));
      border:1px solid rgba(255,255,255,.09);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      overflow:hidden;
    }

    /* NASCAR-like header row for list */
    .listHeader{
      display:grid;
      grid-template-columns: 70px 1fr 84px 34px;
      gap:10px;
      padding:12px 12px;
      border-bottom:1px solid rgba(255,255,255,.08);
      background: rgba(0,0,0,.12);
      color:#cbd5e1;
      font-size:12px;
      text-transform:uppercase;
      letter-spacing:.08em;
      position:sticky;
      top:0;
      z-index:2;
    }
    .listHeader > div{ white-space:nowrap; }
    .listHeader .hPts{ text-align:right; }
    .listHeader .hBlank{ text-align:right; opacity:.7; }

    /* Rows */
    .row{
      border-bottom:1px solid rgba(255,255,255,.08);
      background: rgba(0,0,0,.05);
    }
    .rowBtn{
      width:100%;
      display:grid;
      grid-template-columns: 70px 1fr 84px 34px;
      gap:10px;
      align-items:center;
      padding:12px 12px;
      background:transparent;
      border:0;
      color:inherit;
      cursor:pointer;
      text-align:left;
    }
    .rowBtn:active{ transform: translateY(1px); }

    .pos{
      display:flex;
      flex-direction:column;
      gap:4px;
      font-family:var(--mono);
    }
    .pos .p{
      font-weight:900;
      font-size:16px;
      line-height:1;
    }
    .pos .behind{
      font-size:12px;
      color:var(--muted);
      letter-spacing:.02em;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
      max-width: 66px;
    }

    .nameBlock{
      min-width:0;
      display:flex;
      flex-direction:column;
      gap:4px;
    }
    .nameBlock .nm{
      font-weight:950;
      letter-spacing:.2px;
      font-size:15px;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }
    .nameBlock .meta{
      color:var(--muted);
      font-size:12px;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
      font-family:var(--mono);
    }

    .pts{
      text-align:right;
      font-family:var(--mono);
      font-weight:900;
      font-size:16px;
      letter-spacing:.02em;
      white-space:nowrap;
    }
    .chev{
      text-align:right;
      font-size:22px;
      opacity:.9;
      transition: transform .15s ease;
      line-height:1;
    }

    .row.open{ background: rgba(210,20,4,.07); }
    .row.open .chev{ transform: rotate(180deg); }

    /* Expanded panel (like NASCAR stats grid) */
    .exp{
      display:none;
      padding: 0 12px 12px;
    }
    .row.open .exp{ display:block; }

    .expInner{
      margin-top:10px;
      border:1px solid rgba(255,255,255,.10);
      border-radius: 14px;
      background: rgba(15,23,42,.55);
      overflow:hidden;
    }
    .expTop{
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:10px;
      flex-wrap:wrap;
      padding:10px 10px;
      border-bottom:1px solid rgba(255,255,255,.10);
      background: linear-gradient(180deg, rgba(25,28,39,.55), rgba(15,23,42,.28));
    }
    .badge{
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding:6px 10px;
      border-radius:999px;
      border:1px solid rgba(210,20,4,.35);
      background: rgba(210,20,4,.10);
      font-family:var(--mono);
      font-size:12px;
      color:#ffd6d1;
      white-space:nowrap;
    }
    .badge .mini{ width:7px;height:7px;border-radius:99px;background:var(--accent); }

    .miniHint{
      color:var(--muted);
      font-size:12px;
    }

    /* stat grid like nascar.com */
    .statGrid{
      display:grid;
      grid-template-columns: repeat(4, minmax(0,1fr));
      border-top:1px solid rgba(255,255,255,.08);
    }
    .stat{
      padding:10px 10px;
      border-right:1px solid rgba(255,255,255,.08);
      border-bottom:1px solid rgba(255,255,255,.08);
      text-align:center;
    }
    .stat:nth-child(4n){ border-right:0; }
    .stat .k{
      color:#cbd5e1;
      font-size:12px;
      text-transform:uppercase;
      letter-spacing:.08em;
    }
    .stat .v{
      margin-top:8px;
      font-family:var(--mono);
      font-weight:950;
      font-size:16px;
    }

    .leader{ color:#e5e7eb; }
    .neg{ color:#fca5a5; }

    /* selections block */
    .selBox{
      padding:10px 10px 12px;
      border-top:1px solid rgba(255,255,255,.10);
    }
    .selTitle{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      flex-wrap:wrap;
      margin-bottom:10px;
    }
    .selTitle .t{
      font-weight:900;
      letter-spacing:.2px;
    }
    .chips{
      display:flex;
      gap:8px;
      flex-wrap:wrap;
    }
    .chip{
      padding:6px 10px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(17,24,39,.45);
      font-family:var(--mono);
      font-size:12px;
      color:#d1d5db;
      white-space:nowrap;
    }
    .chip strong{ color:#fff; font-weight:900; }

    /* ‚úÖ stacked selections list */
    .selList{
      display:flex;
      flex-direction:column;
      gap:8px;
      margin-top:8px;
    }
    .selItem{
      border:1px solid rgba(255,255,255,.10);
      background: rgba(17,24,39,.35);
      border-radius:12px;
      padding:10px 10px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      flex-wrap:wrap;
    }
    .selLeft{
      min-width:0;
      display:flex;
      gap:8px;
      align-items:baseline;
      flex-wrap:wrap;
      font-family:var(--mono);
    }
    .selLeft .id{
      color:#cbd5e1;
      font-weight:900;
    }
    .selLeft .driver{
      color:#fff;
      font-weight:900;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
      max-width:min(60vw, 380px);
    }
    .selRight{
      font-family:var(--mono);
      font-weight:950;
      white-space:nowrap;
    }

    .winGold{
      color:#111;
      font-weight:950;
      font-family:var(--mono);
      background:linear-gradient(180deg,var(--gold1),var(--gold2));
      border:1px solid rgba(250,204,21,.6);
      box-shadow:0 0 0 3px rgba(250,204,21,.14);
      border-radius:999px;
      padding:6px 10px;
      display:inline-flex;
      align-items:center;
      gap:6px;
      white-space:nowrap;
      font-size:12px;
    }

    .analysisPad{ padding:12px; }
    .grid2{ display:grid; grid-template-columns: 1fr 1fr; gap:10px; margin-top:10px; }
    .kpiCard{
      border:1px solid rgba(255,255,255,.10);
      border-radius:14px;
      padding:12px;
      background: rgba(17,24,39,.35);
    }
    .kpiCard .k{
      color:var(--muted);
      text-transform:uppercase;
      letter-spacing:.08em;
      font-size:11px;
    }
    .kpiCard .v{
      margin-top:6px;
      font-family:var(--mono);
      font-weight:950;
      font-size:22px;
    }

    .foot{
      margin-top:10px;
      color:var(--muted);
      font-size:12px;
      display:flex;
      justify-content:space-between;
      gap:10px;
      flex-wrap:wrap;
      padding: 0 2px;
    }

    /* Responsive tweaks */
    @media (max-width: 520px){
      .listHeader,
      .rowBtn{
        grid-template-columns: 64px 1fr 76px 30px;
      }
      .brand h1{ font-size:18px; }
      .pts{ font-size:15px; }
      .pos .p{ font-size:15px; }
      .statGrid{ grid-template-columns: repeat(2, minmax(0,1fr)); }
      .stat:nth-child(4n){ border-right:1px solid rgba(255,255,255,.08); }
      .stat:nth-child(2n){ border-right:0; }
    }

    @media (orientation: landscape) and (max-height: 520px){
      .wrap{ margin:10px auto 18px; }
      .brand h1{ font-size:18px; }
      .search input{ padding:9px 12px 9px 36px; }
      .btn, .select, .tab{ padding:9px 10px; }
    }
  </style>
</head>

<body>
  <div class="wrap">
    <div class="top">
      <div class="brand">
        <h1>Fantasy NASCAR League ‚Äî Standings</h1>
        <div class="sub">
          <span class="pill"><span class="dot"></span> Tap a row to expand</span>
          <span class="pill" id="lastUpdated">Updated: ‚Äî</span>
        </div>
      </div>

      <div class="controls">
        <div class="search">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" aria-hidden="true">
            <path d="M21 21l-4.3-4.3m1.3-5.2a7 7 0 11-14 0 7 7 0 0114 0z"
                  stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
          </svg>
          <input id="q" type="text" placeholder="Search fantasy name..." />
        </div>

        <select class="select" id="sort">
          <option value="RANK:asc">Sort: Rank ‚Üë</option>
          <option value="RANK:desc">Sort: Rank ‚Üì</option>
          <option value="TOTAL_POINTS_INCLUDING_BONUS:desc">Sort: Points ‚Üì</option>
          <option value="TOTAL_POINTS_INCLUDING_BONUS:asc">Sort: Points ‚Üë</option>
          <option value="WINS:desc">Sort: Wins ‚Üì</option>
          <option value="TOP_10s:desc">Sort: Top10 ‚Üì</option>
        </select>

        <button class="btn" id="collapseAll">Collapse</button>
        <button class="btn primary" id="expandTop3">Top 3</button>
      </div>
    </div>

    <div class="tabs" role="tablist" aria-label="Page tabs">
      <button class="tab active" role="tab" aria-selected="true" aria-controls="panel-standings" id="tab-standings">Standings</button>
      <button class="tab" role="tab" aria-selected="false" aria-controls="panel-analysis" id="tab-analysis">Analysis</button>
    </div>

    <!-- ===================== STANDINGS ===================== -->
    <section class="tabPanel active" id="panel-standings" role="tabpanel" aria-labelledby="tab-standings">
      <div class="card" id="boardCard">
        <div class="listHeader" aria-hidden="true">
          <div>Pos</div>
          <div>Fantasy</div>
          <div class="hPts">Points</div>
          <div class="hBlank"></div>
        </div>
        <div id="list"></div>
      </div>

      <div class="foot">
        <div>Mobile-first ‚Ä¢ NASCAR-style expand rows ‚Ä¢ version 0.3.1</div>
        <div style="font-family:var(--mono)">HTML + CSS + vanilla JS</div>
      </div>
    </section>

    <!-- ===================== ANALYSIS ===================== -->
    <section class="tabPanel" id="panel-analysis" role="tabpanel" aria-labelledby="tab-analysis">
      <div class="card">
        <div class="analysisPad">
          <div style="display:flex;align-items:center;justify-content:space-between;gap:10px;flex-wrap:wrap">
            <div>
              <div style="font-weight:950;letter-spacing:.2px;font-size:16px">Analysis</div>
              <div class="sub" style="margin-top:6px">
                <span class="pill"><span class="dot"></span> Built from the same data</span>
              </div>
            </div>
            <div class="miniHint">Tell me what you want here and I‚Äôll wire it up.</div>
          </div>

          <div class="grid2">
            <div class="kpiCard">
              <div class="k">Points Leader</div>
              <div class="v" id="kpiLeader">‚Äî</div>
            </div>
            <div class="kpiCard">
              <div class="k">Best Win Rate</div>
              <div class="v" id="kpiWinRate">‚Äî</div>
            </div>
            <div class="kpiCard">
              <div class="k">Most Top 10s</div>
              <div class="v" id="kpiTop10">‚Äî</div>
            </div>
            <div class="kpiCard">
              <div class="k">Most Led ‚â•1 Lap</div>
              <div class="v" id="kpiLedLap">‚Äî</div>
            </div>
          </div>

          <div class="kpiCard" style="margin-top:10px">
            <div class="k">Notes</div>
            <div style="margin-top:8px;color:var(--muted);line-height:1.5">
              Add charts, ‚Äúbest pick next race‚Äù, trends, deltas by race, etc.
            </div>
          </div>
        </div>
      </div>
    </section>
  </div>

<script>
/** =========================
 *  DATA
 *  ========================= */
const standings = [
  { RANK:1,  FANTASY_NAME:"Bill",   STARTS:3, TOTAL_POINTS_INCLUDING_BONUS:141, POINTS_BEHIND:"-",    WINS:1, TOP_5s:2, TOP_10s:2, LED_AT_LEAST_ONE_LAP_IN_RACE:2, LED_MOST_LAPS_IN_A_RACE:1 },
  { RANK:2,  FANTASY_NAME:"Tayhan", STARTS:3, TOTAL_POINTS_INCLUDING_BONUS:119, POINTS_BEHIND:"-22",  WINS:0, TOP_5s:1, TOP_10s:1, LED_AT_LEAST_ONE_LAP_IN_RACE:2, LED_MOST_LAPS_IN_A_RACE:0 },
  { RANK:3,  FANTASY_NAME:"Dylan",  STARTS:3, TOTAL_POINTS_INCLUDING_BONUS:109, POINTS_BEHIND:"-32",  WINS:0, TOP_5s:2, TOP_10s:2, LED_AT_LEAST_ONE_LAP_IN_RACE:3, LED_MOST_LAPS_IN_A_RACE:0 },
  { RANK:4,  FANTASY_NAME:"Conlan", STARTS:3, TOTAL_POINTS_INCLUDING_BONUS:86,  POINTS_BEHIND:"-55",  WINS:0, TOP_5s:2, TOP_10s:2, LED_AT_LEAST_ONE_LAP_IN_RACE:2, LED_MOST_LAPS_IN_A_RACE:0 },
  { RANK:5,  FANTASY_NAME:"Lawson", STARTS:3, TOTAL_POINTS_INCLUDING_BONUS:81,  POINTS_BEHIND:"-60",  WINS:0, TOP_5s:0, TOP_10s:0, LED_AT_LEAST_ONE_LAP_IN_RACE:1, LED_MOST_LAPS_IN_A_RACE:0 },
  { RANK:6,  FANTASY_NAME:"Hunter", STARTS:3, TOTAL_POINTS_INCLUDING_BONUS:75,  POINTS_BEHIND:"-66",  WINS:0, TOP_5s:0, TOP_10s:0, LED_AT_LEAST_ONE_LAP_IN_RACE:2, LED_MOST_LAPS_IN_A_RACE:0 },
  { RANK:7,  FANTASY_NAME:"Ryan",   STARTS:3, TOTAL_POINTS_INCLUDING_BONUS:68,  POINTS_BEHIND:"-73",  WINS:0, TOP_5s:0, TOP_10s:0, LED_AT_LEAST_ONE_LAP_IN_RACE:2, LED_MOST_LAPS_IN_A_RACE:0 },
  { RANK:8,  FANTASY_NAME:"JT",     STARTS:3, TOTAL_POINTS_INCLUDING_BONUS:66,  POINTS_BEHIND:"-75",  WINS:0, TOP_5s:1, TOP_10s:1, LED_AT_LEAST_ONE_LAP_IN_RACE:2, LED_MOST_LAPS_IN_A_RACE:0 },
  { RANK:9,  FANTASY_NAME:"Kevin",  STARTS:3, TOTAL_POINTS_INCLUDING_BONUS:50,  POINTS_BEHIND:"-91",  WINS:0, TOP_5s:0, TOP_10s:0, LED_AT_LEAST_ONE_LAP_IN_RACE:2, LED_MOST_LAPS_IN_A_RACE:0 },
  { RANK:10, FANTASY_NAME:"Chase",  STARTS:3, TOTAL_POINTS_INCLUDING_BONUS:33,  POINTS_BEHIND:"-108", WINS:0, TOP_5s:0, TOP_10s:0, LED_AT_LEAST_ONE_LAP_IN_RACE:3, LED_MOST_LAPS_IN_A_RACE:0 },
];

const detailsRaw = [
  ["Bill",   5596, "Daytona International Speedway", "Brad Keselowski",        5, 33, 0, 1, 1, 0, 0],
  ["Chase",  5596, "Daytona International Speedway", "Chase Briscoe",          36, 2, 0, 0, 0, 1, 0],
  ["Conlan", 5596, "Daytona International Speedway", "Joey Logano",            3, 38, 0, 1, 1, 1, 0],
  ["Dylan",  5596, "Daytona International Speedway", "Chase Elliott",          4, 35, 0, 1, 1, 1, 0],
  ["Hunter", 5596, "Daytona International Speedway", "Michael McDowell",       22, 20, 0, 0, 0, 1, 0],
  ["JT",     5596, "Daytona International Speedway", "Austin Dillon",          37, 1, 0, 0, 0, 0, 0],
  ["Kevin",  5596, "Daytona International Speedway", "Kyle Larson",            16, 22, 0, 0, 0, 1, 0],
  ["Lawson", 5596, "Daytona International Speedway", "William Byron",          12, 25, 0, 0, 0, 0, 0],
  ["Ryan",   5596, "Daytona International Speedway", "Todd Gilliland",         39, 2, 0, 0, 0, 1, 0],
  ["Tayhan", 5596, "Daytona International Speedway", "Ricky Stenhouse Jr.",    2, 37, 0, 1, 1, 1, 0],

  ["Bill",   5597, "Atlanta Motor Speedway",         "Tyler Reddick",          1, 74, 1, 1, 1, 1, 1],
  ["Chase",  5597, "Atlanta Motor Speedway",         "Christopher Bell",       21, 17, 0, 0, 0, 1, 0],
  ["Conlan", 5597, "Atlanta Motor Speedway",         "Ricky Stenhouse Jr.",    36, 1, 0, 0, 0, 0, 0],
  ["Dylan",  5597, "Atlanta Motor Speedway",         "Carson Hocevar",         4, 40, 0, 1, 1, 1, 0],
  ["Hunter", 5597, "Atlanta Motor Speedway",         "Ryan Blaney",            10, 32, 0, 0, 0, 1, 0],
  ["JT",     5597, "Atlanta Motor Speedway",         "Brad Keselowski",        17, 23, 0, 0, 0, 1, 0],
  ["Kevin",  5597, "Atlanta Motor Speedway",         "Josh Berry",             38, 1, 0, 0, 0, 0, 0],
  ["Lawson", 5597, "Atlanta Motor Speedway",         "Brad Keselowski",        17, 23, 0, 0, 0, 1, 0],
  ["Ryan",   5597, "Atlanta Motor Speedway",         "Chris Buescher",         15, 22, 0, 0, 0, 0, 0],
  ["Tayhan", 5597, "Atlanta Motor Speedway",         "Bubba Wallace",          8, 49, 0, 0, 0, 1, 0],

  // --- Added 5598 ---
  ["Ryan",   5598, "Circuit of The Americas",        "AJ Allmendinger",        9, 44, 0, 0, 0, 1, 0],
  ["JT",     5598, "Circuit of The Americas",        "Michael McDowell",       5, 42, 0, 1, 1, 1, 0],
  ["Chase",  5598, "Circuit of The Americas",        "Ross Chastain",          35, 14, 0, 0, 0, 1, 0],
  ["Dylan",  5598, "Circuit of The Americas",        "Ryan Blaney",            8, 34, 0, 0, 0, 1, 0],
  ["Bill",   5598, "Circuit of The Americas",        "Ryan Blaney",            8, 34, 0, 0, 0, 1, 0],
  ["Lawson", 5598, "Circuit of The Americas",        "Chase Elliott",          7, 33, 0, 0, 0, 0, 0],
  ["Tayhan", 5598, "Circuit of The Americas",        "Chase Elliott",          7, 33, 0, 0, 0, 0, 0],
  ["Kevin",  5598, "Circuit of The Americas",        "William Byron",          13, 27, 0, 0, 0, 1, 0],
  ["Conlan", 5598, "Circuit of The Americas",        "Shane van Gisbergen",    2, 47, 0, 1, 1, 1, 0],
  ["Hunter", 5598, "Circuit of The Americas",        "Connor Zilisch",         14, 23, 0, 0, 0, 0, 0],
];

const details = detailsRaw.map(r => ({
  FANTASY_NAME: r[0],
  TRACK_ID: r[1],
  TRACK_NAME: r[2],
  SELECTION: r[3],
  FINISH_POSITION: r[4],
  POINTS_EARNED: r[5],
  WIN: r[6],
  TOP5: r[7],
  TOP10: r[8],
  LED_LAP: r[9],
  LED_MOST: r[10],
}));

const detailByName = details.reduce((acc, row) => {
  (acc[row.FANTASY_NAME] ||= []).push(row);
  return acc;
}, {});

/** =========================
 *  HELPERS
 *  ========================= */
const $ = (id) => document.getElementById(id);

function escapeHtml(str){
  return String(str)
    .replaceAll("&","&amp;")
    .replaceAll("<","&lt;")
    .replaceAll(">","&gt;")
    .replaceAll('"',"&quot;")
    .replaceAll("'","&#039;");
}
function toNum(v){
  if (v === "-" || v === null || v === undefined) return Number.NEGATIVE_INFINITY;
  if (typeof v === "number") return v;
  const n = Number(String(v).trim());
  return Number.isFinite(n) ? n : Number.NEGATIVE_INFINITY;
}
function formatBehind(v){
  if (v === "-") return { text:"LEADER", cls:"leader" };
  const n = Math.abs(Number(v));
  if (!Number.isFinite(n)) return { text:String(v), cls:"" };
  return { text:`-${n}`, cls:"neg" };
}

/** =========================
 *  STATE
 *  ========================= */
const list = $("list");
const q = $("q");
const sortSel = $("sort");
const lastUpdated = $("lastUpdated");

lastUpdated.textContent = "Updated: " + new Date().toLocaleString();

let state = {
  open: new Set(),
  filter: "",
  sortKey: "RANK",
  sortDir: "asc",
};

/** =========================
 *  TABS
 *  ========================= */
const tabStandings = $("tab-standings");
const tabAnalysis  = $("tab-analysis");
const panelStandings = $("panel-standings");
const panelAnalysis  = $("panel-analysis");

function setTab(which){
  const standingsOn = which === "standings";
  tabStandings.classList.toggle("active", standingsOn);
  tabStandings.setAttribute("aria-selected", standingsOn ? "true" : "false");
  tabAnalysis.classList.toggle("active", !standingsOn);
  tabAnalysis.setAttribute("aria-selected", !standingsOn ? "true" : "false");
  panelStandings.classList.toggle("active", standingsOn);
  panelAnalysis.classList.toggle("active", !standingsOn);
  window.scrollTo({ top: 0, behavior: "smooth" });
}
tabStandings.addEventListener("click", () => setTab("standings"));
tabAnalysis.addEventListener("click", () => setTab("analysis"));

/** =========================
 *  SORT / FILTER
 *  ========================= */
function applySortFilter(){
  let rows = standings
    .filter(r => r.FANTASY_NAME.toLowerCase().includes(state.filter.toLowerCase()))
    .slice();

  const k = state.sortKey;
  const dir = state.sortDir === "asc" ? 1 : -1;

  rows.sort((a,b) => {
    if (k === "POINTS_BEHIND"){
      const na = (a.POINTS_BEHIND === "-") ? 0 : Math.abs(toNum(a.POINTS_BEHIND));
      const nb = (b.POINTS_BEHIND === "-") ? 0 : Math.abs(toNum(b.POINTS_BEHIND));
      return (na - nb) * dir;
    }
    const va = a[k], vb = b[k];
    if (typeof va === "string" || typeof vb === "string"){
      return String(va).localeCompare(String(vb), undefined, {numeric:true, sensitivity:"base"}) * dir;
    }
    return (toNum(va) - toNum(vb)) * dir;
  });

  return rows;
}

function toggleOpen(name){
  if (state.open.has(name)) state.open.delete(name);
  else state.open.add(name);
  render();
}

/** =========================
 *  RENDER
 *  ========================= */
function render(){
  const rows = applySortFilter();
  list.innerHTML = "";

  for (const r of rows){
    const isOpen = state.open.has(r.FANTASY_NAME);
    const behind = formatBehind(r.POINTS_BEHIND);

    const d = (detailByName[r.FANTASY_NAME] || []).slice().sort((a,b)=>a.TRACK_ID-b.TRACK_ID);

    const sums = d.reduce((acc, x) => {
      acc.races += 1;
      acc.points += (Number(x.POINTS_EARNED) || 0);
      acc.wins  += (Number(x.WIN) || 0);
      acc.top5  += (Number(x.TOP5) || 0);
      acc.top10 += (Number(x.TOP10) || 0);
      acc.ledLap += (Number(x.LED_LAP) || 0);
      acc.ledMost += (Number(x.LED_MOST) || 0);
      return acc;
    }, {races:0, points:0, wins:0, top5:0, top10:0, ledLap:0, ledMost:0});

    const row = document.createElement("div");
    row.className = "row" + (isOpen ? " open" : "");
    row.innerHTML = `
      <button class="rowBtn" type="button" aria-expanded="${isOpen ? "true":"false"}">
        <div class="pos">
          <div class="p">${r.RANK}</div>
          <div class="behind ${behind.cls}">${escapeHtml(behind.text)}</div>
        </div>

        <div class="nameBlock">
          <div class="nm">${escapeHtml(r.FANTASY_NAME)}</div>
          <div class="meta">Starts ${r.STARTS} ‚Ä¢ Wins ${r.WINS} ‚Ä¢ Top10 ${r.TOP_10s}</div>
        </div>

        <div class="pts">${r.TOTAL_POINTS_INCLUDING_BONUS}</div>
        <div class="chev">‚åÑ</div>
      </button>

      <div class="exp">
        <div class="expInner">
          <div class="expTop">
            <span class="badge"><span class="mini"></span> Stats</span>
            <span class="miniHint">Tap row again to collapse</span>
          </div>

          <div class="statGrid">
            <div class="stat"><div class="k">Behind</div><div class="v ${behind.cls}">${escapeHtml(behind.text)}</div></div>
            <div class="stat"><div class="k">Starts</div><div class="v">${r.STARTS}</div></div>
            <div class="stat"><div class="k">Wins</div><div class="v">${r.WINS}</div></div>
            <div class="stat"><div class="k">Top 5's</div><div class="v">${r.TOP_5s}</div></div>

            <div class="stat"><div class="k">Top 10's</div><div class="v">${r.TOP_10s}</div></div>
            <div class="stat"><div class="k">Led ‚â•1 Lap</div><div class="v">${r.LED_AT_LEAST_ONE_LAP_IN_RACE}</div></div>
            <div class="stat"><div class="k">Most Led</div><div class="v">${r.LED_MOST_LAPS_IN_A_RACE}</div></div>
            <div class="stat"><div class="k">Races Logged</div><div class="v">${sums.races}</div></div>
          </div>

          <div class="selBox">
            <div class="selTitle">
              <div class="t">Selections</div>
              <div class="chips">
                <span class="chip">Points (logged): <strong>${sums.points}</strong></span>
                <span class="chip">Wins (logged): <strong>${sums.wins}</strong></span>
                <span class="chip">Top10 (logged): <strong>${sums.top10}</strong></span>
              </div>
            </div>

            ${
              d.length
                ? `
                  <div class="selList">
                    ${d.slice().reverse().map(x => `
                      <div class="selItem">
                        <div class="selLeft">
                          <span class="id">${x.TRACK_ID}</span>
                          <span>‚Ä¢</span>
                          <span class="driver">${escapeHtml(x.SELECTION)}</span>
                          <span>‚Ä¢</span>
                          <span>Pts ${x.POINTS_EARNED}</span>
                        </div>
                        <div class="selRight">
                          ${Number(x.WIN) === 1 ? `<span class="winGold">üèÜ WIN</span>` : ``}
                        </div>
                      </div>
                    `).join("")}
                  </div>
                `
                : `<div class="miniHint">No selection rows yet.</div>`
            }
          </div>
        </div>
      </div>
    `;

    row.querySelector(".rowBtn").addEventListener("click", () => toggleOpen(r.FANTASY_NAME));
    list.appendChild(row);
  }

  renderAnalysisKPIs();
}

function renderAnalysisKPIs(){
  const leader = standings.slice().sort((a,b)=>b.TOTAL_POINTS_INCLUDING_BONUS-a.TOTAL_POINTS_INCLUDING_BONUS)[0];
  $("kpiLeader").textContent = leader ? `${leader.FANTASY_NAME} (${leader.TOTAL_POINTS_INCLUDING_BONUS})` : "‚Äî";

  const wr = standings
    .filter(x => (Number(x.STARTS)||0) > 0)
    .map(x => ({name:x.FANTASY_NAME, rate:(Number(x.WINS)||0)/(Number(x.STARTS)||1)}))
    .sort((a,b)=>b.rate-a.rate)[0];
  $("kpiWinRate").textContent = wr ? `${wr.name} (${Math.round(wr.rate*100)}%)` : "‚Äî";

  const t10 = standings.slice().sort((a,b)=>(b.TOP_10s||0)-(a.TOP_10s||0))[0];
  $("kpiTop10").textContent = t10 ? `${t10.FANTASY_NAME} (${t10.TOP_10s})` : "‚Äî";

  const led = standings.slice().sort((a,b)=>(b.LED_AT_LEAST_ONE_LAP_IN_RACE||0)-(a.LED_AT_LEAST_ONE_LAP_IN_RACE||0))[0];
  $("kpiLedLap").textContent = led ? `${led.FANTASY_NAME} (${led.LED_AT_LEAST_ONE_LAP_IN_RACE})` : "‚Äî";
}

/** =========================
 *  CONTROLS
 *  ========================= */
q.addEventListener("input", (e) => {
  state.filter = e.target.value || "";
  render();
});

$("sort").addEventListener("change", (e) => {
  const [key, dir] = String(e.target.value).split(":");
  state.sortKey = key;
  state.sortDir = dir;
  render();
});

$("collapseAll").addEventListener("click", () => {
  state.open.clear();
  render();
});

$("expandTop3").addEventListener("click", () => {
  state.open.clear();
  standings.slice().sort((a,b)=>a.RANK-b.RANK).slice(0,3).forEach(x => state.open.add(x.FANTASY_NAME));
  render();
});

/** =========================
 *  INIT
 *  ========================= */
$("lastUpdated").textContent = "Updated: " + new Date().toLocaleString();
render();
</script>
</body>
</html>
